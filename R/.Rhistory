sqrtV1.j = t(chol(V1.j));
beta[,j] = m1.j + sqrtV1.j %*% rnorm(P);
## A += exp(X %*% beta[,j]) - exp(X %*% beta[,(j+1) %% (J-1)])
## Store
if (i > burn) {
out$beta[i-burn,,j] = beta[,j];
}
}
if (i %% verbose == 0) cat("Finished", i, "\n");
}
##Process the result
dim(out$beta) <- c(samp,P*(J-1))
out <- as.matrix(out$beta)
indx <- seq(step, samp, step)
out2 <- out[indx, ]
if(!is.na(file_path)){
utils::write.table(out, file=paste(file_path,"/result.txt",sep=''), row.names=FALSE, col.names=FALSE)
}
if(trace.plot == TRUE){
dir.create("./TracePlots")
for(i in 1:dim(out)[2]){
grDevices::png(file=paste("./","TracePlot",i,".png"))
p <- plot(x=1:dim(out)[1],y=out[,i],type="l",main="Trace plot")
grDevices::dev.off()
}
}
result <- list(out = out, outwstep = out2)
return(result)
}
data <- lifedata
y <- data[,1]
X <- data[,-1]
out <- mlogit(y, X ,samp=10, burn=10,verbose=10)
devtools::check()
use_gpl_license()
usethis::use_gpl_license()
devtools::check()
?model.matrix
devtools::check()
devtools::document()
?usethis
devtools::document()
devtools::document()
?mlogit
??mlogit
?mlogit
packageDescription(mlogit)
packageDescription(pkg=mlogit)
packageVersion(mlogit)
?mlogit
devtools::document()
devtools::document()
?mlogit
mlifeTable <- function(y,X,
trans,
states,
file_path,
groupby=NA,
vars = colnames(X),
status = 0,
startages=50,
endages=110,
nums = 1000,
mplot = FALSE,
...
){
##Subgroup
age.index <- which(colnames(as.data.frame(X)) %in% "age" ==TRUE)
data <- as.data.frame(X[,-age.index])
cols <- colnames(data)
vars.group <- groupby
vars.other <- setdiff(cols,groupby)
##Construct index matrix
if(!is.na(vars.group[1])){
data.group.list <- lapply(data[,vars.group],c)
index.matrix <- sapply(unique(data[,vars.group]),as.character)
}
else{
data.group.list <- list('a' = rep(1,dim(data)[1]))
index.matrix <- sapply(expand.grid(list('a' = 1)),as.character)
}
##Subgroup means
data.sub <- list()
data.sub.sample <- list(tapply(data[,1],data.group.list,length))
for(i in vars.other){
if(i %in% vars){
data.sub <- append(data.sub,list(tapply(data[,i],data.group.list,mean)))
}
else{
data.sub <- append(data.sub,list(mean(data[,i])))
}
}
names(data.sub) <- vars.other
##Construct life tables
g <- trans
e <- matrix(NA,nums,states)
ages <- seq(startages,endages,by=2)
#Create the values for matrix covariates.
for(index in 1:ifelse(is.null(dim(index.matrix)[1]),1,dim(index.matrix)[1])){
if(is.null(colnames(index.matrix)[1]) | is.na(vars[1])){
values <- colMeans(data)
}
#Check the existence of this subgroup
else if(!is.na(data.sub[[vars[1]]][t(index.matrix[index,vars.group])])){
values <- NULL
for(i in 1:length(cols)){
#Find the place of this covariate.
if(cols[i] %in% vars.other & cols[i] %in% vars){
values[i] <- data.sub[[cols[i]]][t(index.matrix[index,vars.group])]
}
else if(cols[i] %in% vars.group){
values[i] <- as.numeric(index.matrix[index,cols[i]])
}
else{values[i] <- as.numeric(data.sub[[cols[i]]][1])}
}
}
else{next}
#Construct life tables.
for(reps in 1:nums){
b <- g[reps,]
for(i in 1:(length(ages))){
covariates <- matrix(c(1,append(values, ages[i], after=(age.index-1)))
,1,length(cols)+2)
c_length <- ncol(covariates)
# (1*13)%*%(11*19)
xb <- covariates%*%matrix(as.numeric(b),c_length,length(g)/c_length)
tp <- matrix(0,length(xb)+1)
denom <- 1+sum(exp(xb))
for(j in 1:length(xb)){
tp[j] <- exp(xb[j])/denom
}
tp[length(xb)+1]=1-sum(tp)
p=matrix(c(rep(0,states-1),1),states,states,byrow=T)
pos=sort(unique(y))
#populate transition matrix
count <- 0; m <- 1
for(j in 1:(states-1)){
for(k in 1:states){
count=count+1
if(pos[m]==count){
p[j,k]=tp[m]
m=m+1
}
}
}
#establish radix
if(i==1){
radix=rowSums(p)
radix[states]=0
if(status!=0){
radix=rep(0,n=states)
radix[status]=1
}
lx=matrix(radix,length(ages),states,byrow=T)
Lx=Tx=ex=matrix(0,length(ages),states)
}
for(j in 1:(states-1)){
p[j,]=p[j,]/sum(p[j,])
}
if(i<length(ages)){
#generate lx+1 from lx & p
lx[i+1,]=lx[i,]%*%p
#generate Lx from lx and lx+1
Lx[i,]=lx[i,]+lx[(i+1),]
}
######to close out life table Lx
if(i==length(ages)){
Lxx=2*lx[(length(ages)),1:(nrow(p)-1)]%*%solve(diag(nrow(p)-1)-p[1:(states-1),1:(states-1)])
Lx[(length(ages)),]=cbind(Lxx,c(0))
#Lx[(length(ages)),]=2*lx[(length(ages)),]%*%solve(p)
}
#close ages loop
}
#generate life expectancies
for(i in 1:(length(ages)-1)){
Tx[i,]=colSums(Lx[i:(length(ages)),])
ex[i,]=Tx[i,]/sum(lx[i,1:(ncol(lx)-1)])
}
Tx[(length(ages)),]=Lx[(length(ages)),]
ex[(length(ages)),]=Tx[(length(ages)),]/sum(lx[(length(ages)),1:(ncol(lx)-1)])
#save only e0
e[reps,]=ex[1,]
#print(c(index.matrix[index,],reps))
}
write(t(e),
file = paste(paste(file_path,"/lifetable",sep=''),
ifelse(is.null(dim(index.matrix)[1]),
1,
paste(index.matrix[index,],collapse = '')),
".txt",
sep=""),
sep = " ",
ncolumns=ncol(e))
print(paste("complete subgroup:",
paste(ifelse(is.null(dim(index.matrix)[1]),
1,
paste(index.matrix[index,],collapse = '')),
collapse = '')))
print(paste("subgroup sample size:",
data.sub.sample[[1]][t(index.matrix[index,])]))
}
if(mplot == TRUE){
file <- paste(file_path,"/Plots",sep='')
dir.create(file)
mplot(X=X,
status = status,
groupby = groupby,
states = states,
file_path = file,
...)
}
}
data=read.csv("data20220410.csv")
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
mlogit
?mlogit
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
devtools::document()
?mlogit
?mlogit
devtools::document()
?mlogit
ï¼Ÿmlogit
?mlogit
devtools::document()
?mlifetable
devtools::document()
?mlifetable
?mlifetable
devtools::document()
?mlifetable
?mlifetable
devtools::document()
?mlifetable
?mlifetable
devtools::document()
?mlifetable
?mlifetable
data <- read_dta("randhrs1992_2018v1.dta")
library(haven)
data <- read_dta("randhrs1992_2018v1.dta")
data
library(haven)
data <- read_dta("randhrs1992_2018v1.dta")
data <- read_dta("C:\\Users\\27448\\Desktop\\Yale\\Project\\SummerRA\\6.7\\randhrs1992_2018v1_STATA\\randhrs1992_2018v1.dta")
data$s1educ
View(lifedata)
?region
lifedata[,1]
devtools::document()
?lifedata
?lifedata
devtools::document()
?lifedata
?lifedata
devtools::document()
?lifedata
devtools::document()
?lifetable
?lifetable
?lifedata
devtools::document()
?lifedata
devtools::document()
?lifedata
?mlifetable
devtools::document()
?mlifetable
devtools::document()
?mlifetable
?mlogit
?mlogit
devtools::document()
devtools::document()
devtools::document()
devtools::document()
?mlifeTable()
devtools::document()
devtools::document()
?mlogit
devtools::document()
?mlogit
?mlogit
?mlifeTable
?mlifeTable_plot
devtools::document()
?mlifeTable_plot
?mlifeTable_plot
?mlifeTable
?mlogit
?mlifeTable_plot
?life_compare
?mlifeTable_plot
devtools::document()
?mlifeTable_plot
devtools::document()
?mlifeTable_plot
devtools::document()
?mlifeTable_plot
devtools::document()
?mlifeTable_plot
?mlifeTable
?mlogit
13*35
13*35
?mlogit
?mlifeTable
?mlogit
?mlifeTable
?lifedata
lifedata
?mlifetable_plot
?life_compare
devtools::load_all()
?mlogit()
?mlifeTable
devtools::check()
devtools::check()
devtools::check()
devtools::check()
lifedata<- read.csv("./lifedata.csv",row.names=1)
?ggplot2
??ggplot2
devtools::document()
devtools::document()
devtools::load_all()
?lifedata
?lifedata
#' Data for generating life tables.
#'
#' Data extracted and processed from The Health and Retirement Study (HRS).
#'
#' Each subject has 9 status in the cohort: 1: health; 2: hearts & stroke; 3: cancer; 4: hearts and cancer; 5: diabetes; 6: hearts and diabetes;
#' 7: diabetes and cancer; 8: Hearts, cancer and diabetes; 9: death.
#'
#' Thus, our data will have \code{choose(9,2)*2 = 9\*9-9=72} kinds of transition status. To check the transition status for each subject, please use \code{lifedata[,1]}.
#'
#' To use this package on your data, please make sure your data have a transition status vector.
#'
#' @format A data frame with 7321 rows and 13 variables:
#' \describe{
#'   \item{trans}{Transition status was recorded in the original data. In this data, we have 72 status in total.}
#'   \item{age}{Age for each subject.}
#'   \item{male}{Sex for each subject. male=1, female=0}
#'   \item{black,other,hispanic}{Dummy variables for Race.}
#'   \item{edu}{Education level. Education is measured as below high school (less than 12 years of education) (edu=1), high school or some college (12-15 years of education) (edu=2), and college or higher (at least 16 years of education) (edu=3).}
#'   \item{region}{Region of Birth and residence.}
#'   \item{immigrant}{Immigrant status. Immigrant = 1, Not Immigrant = 0.}
#'   \item{cohort}{Cohort. Birth cohort, which is birth year minus 1900. }
#'   \item{norcg, cogcg, demcg}{Dummy variables for Caregiver Type.}
#' }
#' @source \url{https://hrsdata.isr.umich.edu/data-products/rand?_ga=2.225225498.1006069885.1653670364-1014684070.1647264850}
"lifedata"
devtools::load_all()
devtools::document()
?lifedata
devtools::load_all()
?lifedata
?lifedata
?lifedata
?lifedata
#' Data for generating life tables.
#'
#' Data extracted and processed from The Health and Retirement Study (HRS).
#'
#' Each subject has 9 status in the cohort: 1: health; 2: hearts & stroke; 3: cancer; 4: hearts and cancer; 5: diabetes; 6: hearts and diabetes;
#' 7: diabetes and cancer; 8: Hearts, cancer and diabetes; 9: death.
#'
#' Thus, our data will have \code{choose(9,2)*2 = 9\*9-9=72} kinds of transition status. To check the transition status for each subject, please use \code{lifedata[,1]}.
#'
#' To use this package on your data, please make sure your data have a transition status vector.
#'
#' @format A data frame with 7321 rows and 13 variables:
#' \describe{
#'   \item{trans}{Transition status was recorded in the original data. In this data, we have 72 status in total.}
#'   \item{age}{Age for each subject.}
#'   \item{male}{Sex for each subject. male=1, female=0}
#'   \item{black,other,hispanic}{Dummy variables for Race.}
#'   \item{edu}{Education level. Education is measured as below high school (less than 12 years of education) (edu=1), high school or some college (12-15 years of education) (edu=2), and college or higher (at least 16 years of education) (edu=3).}
#'   \item{region}{Region of Birth and residence.}
#'   \item{immigrant}{Immigrant status. Immigrant = 1, Not Immigrant = 0.}
#'   \item{cohort}{Cohort. Birth cohort, which is birth year minus 1900. }
#'   \item{norcg, cogcg, demcg}{Dummy variables for Caregiver Type.}
#' }
#' @source \url{https://hrsdata.isr.umich.edu/data-products/rand?_ga=2.225225498.1006069885.1653670364-1014684070.1647264850}
"lifedata"
?lifedata
?mlogit
getwd()
knitr::opts_chunk$set(echo = F)
y<-simdata$trans
simdata <- as.data.frame(matrix(ncol = 6, nrow = 300))
colnames(simdata) <- c('trans', 'age', 'race', 'area', 'inc', 'gender')
simdata$trans<- sample(10, size = nrow(simdata), replace = TRUE)
simdata$age<- sample(seq(from=20,to=90), size = nrow(simdata), replace = TRUE)
simdata$race<- sample(1:4, size = nrow(simdata), replace = TRUE)
simdata$area<- sample(1:20, size = nrow(simdata), replace = TRUE)
simdata$gender<- sample(0:1, size = nrow(simdata), replace = TRUE)
simdata$inc<- sample(0:500, size = nrow(simdata), replace = TRUE)/100
y<-simdata$trans
x<-simdata[,-1]
out<-mlogit(y=y,X=x,samp=2000, burn=20,verbose=10)
lt<-mlifeTable(y=y,X=x,trans =out$outwstepwidth,
groupby = "gender",
states=4,
nums = 5,
file_path=".")
devtools::install_github("Xuezhixing-Zhang/mlogit")
devtools::install_github("Xuezhixing-Zhang/mlogit")
devtools::install_github("Xuezhixing-Zhang/mlogit")
library(mlogit)
##Check Documentations
?mlogit
library(mlogit)
remove.packages("mlogit")
remove.packages("mlogit")
devtools::install_github("Xuezhixing-Zhang/mlogit")
getwd()
#' Data for generating life tables.
#'
#' Data extracted and processed from The Health and Retirement Study (HRS).
#'
#' Each subject has 9 status in the cohort: 1: health; 2: hearts & stroke; 3: cancer; 4: hearts and cancer; 5: diabetes; 6: hearts and diabetes;
#' 7: diabetes and cancer; 8: Hearts, cancer and diabetes; 9: death.
#'
#' Thus, our data will have \code{choose(9,2) \eqn{x_1}{x1} 2 = 9{*}9-9=72} kinds of transition status. To check the transition status for each subject, please use \code{lifedata[,1]}.
#'
#' To use this package on your data, please make sure your data have a transition status vector.
#'
#' @format A data frame with 7321 rows and 13 variables:
#' \describe{
#'   \item{trans}{Transition status was recorded in the original data. In this data, we have 72 status in total.}
#'   \item{age}{Age for each subject.}
#'   \item{male}{Sex for each subject. male=1, female=0}
#'   \item{black,other,hispanic}{Dummy variables for Race.}
#'   \item{edu}{Education level. Education is measured as below high school (less than 12 years of education) (edu=1), high school or some college (12-15 years of education) (edu=2), and college or higher (at least 16 years of education) (edu=3).}
#'   \item{region}{Region of Birth and residence.}
#'   \item{immigrant}{Immigrant status. Immigrant = 1, Not Immigrant = 0.}
#'   \item{cohort}{Cohort. Birth cohort, which is birth year minus 1900. }
#'   \item{norcg, cogcg, demcg}{Dummy variables for Caregiver Type.}
#' }
#' @source \url{https://hrsdata.isr.umich.edu/data-products/rand?_ga=2.225225498.1006069885.1653670364-1014684070.1647264850}
"lifedata"
devtools::document()
?lifedata
devtools::document()
?lifedata
#' Data for generating life tables.
#'
#' Data extracted and processed from The Health and Retirement Study (HRS).
#'
#' Each subject has 9 status in the cohort: 1: health; 2: hearts & stroke; 3: cancer; 4: hearts and cancer; 5: diabetes; 6: hearts and diabetes;
#' 7: diabetes and cancer; 8: Hearts, cancer and diabetes; 9: death.
#'
#' Thus, our data will have \code{choose(9,2) * 2 = 9*9-9=72} kinds of transition status. To check the transition status for each subject, please use \code{lifedata[,1]}.
#'
#' To use this package on your data, please make sure your data have a transition status vector.
#'
#' @format A data frame with 7321 rows and 13 variables:
#' \describe{
#'   \item{trans}{Transition status was recorded in the original data. In this data, we have 72 status in total.}
#'   \item{age}{Age for each subject.}
#'   \item{male}{Sex for each subject. male=1, female=0}
#'   \item{black,other,hispanic}{Dummy variables for Race.}
#'   \item{edu}{Education level. Education is measured as below high school (less than 12 years of education) (edu=1), high school or some college (12-15 years of education) (edu=2), and college or higher (at least 16 years of education) (edu=3).}
#'   \item{region}{Region of Birth and residence.}
#'   \item{immigrant}{Immigrant status. Immigrant = 1, Not Immigrant = 0.}
#'   \item{cohort}{Cohort. Birth cohort, which is birth year minus 1900. }
#'   \item{norcg, cogcg, demcg}{Dummy variables for Caregiver Type.}
#' }
#' @source \url{https://hrsdata.isr.umich.edu/data-products/rand?_ga=2.225225498.1006069885.1653670364-1014684070.1647264850}
"lifedata"
?lifedata
devtools::document()
devtools::document()
?lifedata
devtools::document()
?lifedata
devtools::document()
